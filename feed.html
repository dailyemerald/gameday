<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="css/dev.css">

	<script src="js/libs/modernizr-2.5.3.min.js"></script>
	<script src="js/libs/zepto.min.js"></script>

	<script src="http://dev.dailyemerald.com:8100/socket.io/socket.io.js"></script>

	<script id="photo" type="text/html">
	      <li>
	        <a href="{{ permalink }}" target="_blank">
				<img src="{{ src }}"></img>
			</a><br>
			<span class="caption">{{ caption }}</span><br>
			Posted: {{ datestring }}<br> 
			<!--By: <a href="{{ permalink }}">{{ username }}</a>-->
	      </li>
	</script>
	
	
	<script type="text/javascript">
	
	function buildEntry(item) { // get a json object, does somt stuff, returns html ready to be inserted
		var datestring = new Date(parseInt(item.created_time)*1000).toLocaleString();
		var caption  = "";
		if (item.caption && item.caption.text) {
			caption = '"'+ item.caption.text +'"';
		}
		//console.log(datestring)
		var photo_data = {
			src: item.images.low_resolution.url, //item.images.standard_resolution.url,
			caption: caption,
			datestring: datestring,
			permalink: item.link,
			username: item.user.full_name
		}
		return ich.photo(photo_data);
	}
	
	$(document).ready(function() {

	});
	
	var socket = io.connect('http://dev.dailyemerald.com:8100');
	socket.on('hello', function (data) {
		//console.log(data);
	    //socket.emit('my other event', { my: 'data' });
	});
	socket.on('fullset', function(fullset) {
		var fullset = JSON.parse(fullset);
		window.fullset = fullset;
 		console.log(fullset);
		var ids = fullset.ids;
		var photos = fullset.photos;
		//console.log('socket got fullset', ids, photos)
		
		$("#loadingtext").empty();
		
		ids.forEach(function(id) {
			//console.log(id, photos[id]);
			var item = photos[id];
			$("#photos").append(buildEntry(item));
		});

		$("img").lazyload({
			threshold: 0
		});

	});
	socket.on('new_photo', function(item) {
		var item = JSON.parse(item);
		//console.log(item);
		$("#photos").prepend( buildEntry(item) );
		
		
	});
	
	</script>

</head>
</head>
<body class="fan-feed">
	
	<div id="wrapper">
		
		<div class="main">
			<ul class="feed clearfix">				
					<li class="tweet">
						<img src="assets/news-thumb.png" class="thumb" />
						<h2 class="tweet-title">Go Ducks</h2>
						<a href="" class="tweet-content">Of Oregon's 19 athletic programs 8 finished ranked 9th or higher nationally during 2011-2012 academic</a>
						<p class="time">3hr</p>
					</li>

					<li class="tweet">
						<img src="assets/news-thumb.png" class="thumb" />
						<h2 class="tweet-title">Go Ducks</h2>
						<a href="" class="tweet-content">Of Oregon's 19 athletic programs 8 finished ranked 9th or higher nationally during 2011-2012 academic</a>
						<p class="time">3hr</p>
					</li>

					<li class="tweet">
						<img src="assets/news-thumb.png" class="thumb" />
						<h2 class="tweet-title">Go Ducks</h2>
						<a href="" class="tweet-content">Of Oregon's 19 athletic programs 8 finished ranked 9th or higher nationally during 2011-2012 academic</a>
						<p class="time">3hr</p>
					</li>

					<li class="tweet">
						<img src="assets/news-thumb.png" class="thumb" />
						<h2 class="tweet-title">Go Ducks</h2>
						<a href="" class="tweet-content">Of Oregon's 19 athletic programs 8 finished ranked 9th or higher nationally during 2011-2012 academic</a>
						<p class="time">3hr</p>
					</li>

					<li class="tweet">
						<img src="assets/news-thumb.png" class="thumb" />
						<h2 class="tweet-title">Go Ducks</h2>
						<a href="" class="tweet-content">Of Oregon's 19 athletic programs 8 finished ranked 9th or higher nationally during 2011-2012 academic</a>
						<p class="time">3hr</p>
					</li>

					<li class="tweet">
						<img src="assets/news-thumb.png" class="thumb" />
						<h2 class="tweet-title">Go Ducks</h2>
						<a href="" class="tweet-content">Of Oregon's 19 athletic programs 8 finished ranked 9th or higher nationally during 2011-2012 academic</a>
						<p class="time">3hr</p>
					</li>

					<li class="instagram">
						<img src="assets/instagram.jpeg" class="insta-img" />
						<img src="assets/news-thumb.png" class="thumb" />
						<h2 class="instagram-title">Go Ducks</h2>
						<a href="" class="instagram-comment">Of Oregon's 19 athletic programs 8 finished ranked 9th or higher nationally during 2011-2012 academic</a>
						<p class="time">3hr</p>
					</li>

					<li class="instagram">
						<img src="assets/instagram-2.jpeg" class="insta-img" />
						<img src="assets/news-thumb.png" class="thumb" />
						<h2 class="instagram-title">Go Ducks</h2>
						<a href="" class="instagram-comment">Of Oregon's 19 athletic programs 8 finished ranked 9th or higher nationally during 2011-2012 academic</a>
						<p class="time">3hr</p>
					</li>

				</ul>
		</div> <!-- .main -->	
	</div> <!-- #wrapper -->

</body>
</html>